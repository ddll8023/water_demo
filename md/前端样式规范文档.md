# 前端样式规范文档

本项目的 `styles` 目录采用“变量与混入驱动”的样式体系，不提供全局工具类。开发时仅使用 CSS 变量与组件内 `<style scoped>`，按需引用混入（mixins）。尽量复用通用样式变量，除非高度定制化可以创建新变量，如果有新变量需要创建，则需要另外说明。

## 核心原则

### 变量分离原则

- **通用变量**：跨组件共用的基础变量（颜色系统、间距、字体、尺寸等）统一在 `variables.scss` 中定义。
- **业务专用变量**：仅在缺失通用变量很多且具有明确业务特色时，才在 `business/` 对应模块中定义。
  。

### 优先级规则

1. **优先使用**现有通用变量
2. **其次考虑**在通用变量中补充缺失的变量（**仅限可复用场景**）
3. **最后考虑**创建业务模块变量（仅在缺失变量很多且具有明确业务特色的情况下）

**关键原则**：只有在多个组件或模块中确实需要复用的样式值，才应该提升为通用变量或业务专用变量。单一组件专用的样式逻辑应保持在组件内部，避免过度抽象。

## 目录定位

- `frontend/src/assets/styles/variables.scss`：**仅全局通用** CSS 变量，包含 9 大系统：标准颜色系统（基础色、功能色、中性色）、透明度色系统（黑白主色透明度）、深色主题变量、字体系统（字体族、13 个字号、4 个字重、3 个行高）、间距系统、尺寸规范系统（20 个布局尺寸变量）、视觉样式系统（圆角、阴影、边框）、层级管理系统（11 个 z-index 变量）、响应式断点、动画过渡系统（13 个过渡动画变量含毛玻璃效果）。
- `frontend/src/assets/styles/mixins.scss`：全局混入（响应式断点 `respond-to`、布局 `flex-*`、文本省略、按钮/卡片样式、滚动条、状态等）+ 业务专用混入。
- `frontend/src/assets/styles/base/reset.scss`：基础重置，仅元素选择器。
- `frontend/src/assets/styles/base/animations.scss`：仅保留 `@keyframes`（如地图业务 `amap-*`，以及组件通用动画 `fadeIn`、`slideIn*`、`scaleIn`）。
- `frontend/src/assets/styles/business/colors/`：业务专用颜色变量（地图设施、监测站、区域、图表监测组件等）。
- `frontend/src/assets/styles/business/icons/`：业务专用图标符号变量（地图设施图标、监测站图标、预警级别图标等）。
- 业务专用动画变量：按业务归属到对应颜色模块中维护（例如地图相关变量在 `frontend/src/assets/styles/business/colors/map.scss`）。

## 引用约定

- 组件内样式统一引入：
  - `@use "@/assets/styles/index.scss" as *;`
- 仅在组件内定义样式规则，禁止新增全局工具类。

## 常见场景与对应文件

**优先原则**：在查找变量时，优先在通用变量中查找，确认通用变量无法满足需求时，再考虑业务专用变量。

### 通用样式变量

- 颜色/主题：在 `variables.scss` 查找 `--primary-color`、`--text-*`、`--bg-*`、`--border-*`，暗色主题在同文件 `[data-theme="dark"]` 下。
- 透明度色系统：在 `variables.scss` 查找 `--black-transparent-*`、`--white-transparent-*`、`--primary-transparent-*` 用于遮罩、玻璃效果。
- 间距/尺寸：在 `variables.scss` 查找 `--spacing-*`（含 `--spacing-micro/mini/xs/small/sm/medium/base/large/extra-large`）、`--header-height`、`--sidebar-width`、`--table-row-height` 等 20 个布局变量。
- 圆角/阴影：在 `variables.scss` 查找 `--border-radius-*`（含 `--border-radius-small/base/md/large/xl/round`）、`--shadow-*`（含 `--shadow-md/card/hover-button`）。
- 字体：在 `variables.scss` 查找 `--font-family-*`、13 个 `--font-size-*`（从 micro 到 icon-notice）、4 个 `--font-weight-*`、3 个 `--line-height-*`。
- 层级管理：在 `variables.scss` 查找 11 个 `--z-index-*` 变量（含基础 UI、交互组件、地图专用层级）。
- 动画过渡：在 `variables.scss` 查找 13 个 `--transition-*` 变量（含毛玻璃、弹窗、交互动画参数）；关键帧在 `base/animations.scss`。
- 响应式断点与布局混入：在 `mixins.scss` 使用 `@include respond-to(sm|md|lg|xl)`、`@include flex-center` 等。

### 业务专用变量（谨慎使用）

仅在通用变量无法满足且缺失变量较多时使用：

- 地图业务颜色：在 `business/colors/map.scss` 查找 `--facility-*`、`--station-*`、`--area-*` 变量。
- 地图业务图标：在 `business/icons/map.scss` 查找 `--facility-*-symbol`、`--station-*-symbol`、`--warning-level-*-symbol` 变量。
- 图表监测组件：在 `business/colors/chart.scss` 查找 `--chart-*` 变量（背景渐变、阴影、边框、过渡动画）。

注意：对于新组件开发，优先考虑在通用变量中补充所需变量，而非创建新的业务专用变量。

### 混入使用

- 通用混入：在 `mixins.scss` 使用 `@include flex-center`、`@include text-ellipsis` 等。

### 第三方组件

- Element Plus 定制：优先使用变量（如 `--el-*`），在组件内通过 `:deep()` 覆盖子组件样式。

## 实施要点

### 基础原则

- 统一入口：仅通过 `index.scss` 引入变量与混入；不再引入任何工具类文件。
- 组件内样式：遵循 BEM，使用 CSS 变量，不使用 `.m-*`、`.flex*`、`.text-*` 等类名。
- 覆盖第三方样式：使用 `:deep()`，控制范围在组件内部。

### 通用变量优先策略

- **通用变量优先**：组件开发时首先查找和使用 `variables.scss` 中的通用变量。
- **复用性评估**：补充通用变量前，必须确认在至少 2 个不同组件中有相同样式值的复用需求。
- **补充通用变量**：缺失变量时，仅在确认跨组件复用价值后才在 `variables.scss` 中补充通用变量。
- **谨慎使用业务变量**：仅在缺失变量数量较多（5 个以上）且具有明确业务特色时，才考虑在 `business/colors/` 或 `business/icons/` 中创建业务专用变量。
- **禁止混入**：通用变量文件中不得包含任何业务专用变量。
- **核心原则**：不能复用则保持硬编码，避免过度抽象。

### 复用性判断决策流程

1. **搜索现有变量**：在 `variables.scss` 和 `business/colors/` 中查找相同值
2. **跨组件搜索**：使用 `grep` 搜索项目中相同硬编码值的使用情况
3. **复用性确认**：
   - ≥2 个组件使用相同值 → 提升为通用变量
   - 仅 1 个组件使用 → 保持硬编码
   - 特殊用法（渐变、交互逻辑）→ 保持硬编码
4. **业务特色评估**：地图、图表等模块专用值考虑业务变量

### 变量扩展策略

- **复用性评估优先**：新变量创建前必须评估复用性，只有在至少 2 个不同组件中需要使用相同样式值时，才考虑提升为变量。
- **优先扩展通用变量**：在 `variables.scss` 中补充缺失的通用变量（如缩略图尺寸、状态颜色等），但必须确保跨组件复用。
- **谨慎创建业务变量**：仅在以下情况考虑业务模块变量：
  - 缺失变量数量较多（5 个以上）
  - 具有明确的业务特色且不适用于其他模块
  - 已有成熟的业务模块（如地图、图表等）
  - **且在该业务模块内有多个组件复用需求**
- **业务模块创建**：确需创建时在 `business/colors/` 或 `business/icons/` 中新增模块文件。
- **组件专用逻辑**：单一组件专用的样式计算、动画、尺寸逻辑等，应保持在组件内部，不应提升为变量或混入。

### 硬编码保留原则

**强制保留硬编码的场景**：

- **组件交互逻辑专用值**：拖拽偏移、点击反馈距离等交互参数
- **组件特定尺寸**：仅单个组件使用的容器高度、内边距等
- **组件状态专用样式**：仅限于特定组件的状态颜色、背景等
- **特殊用法参数**：渐变中间值、动画关键帧、滤镜参数等
- **业务逻辑绑定值**：与组件功能强耦合的数值参数

**判断标准**：

- 仅 1 个组件使用 → 硬编码
- 值与组件功能强绑定 → 硬编码
- 特殊 CSS 语法中的值 → 硬编码

### 组件开发规范

- **禁止**在组件内定义 SCSS 变量或混入。
- **必须**优先使用通用变量。
- **复用性判断**：新值必须先搜索项目确认复用需求，≥2 个组件使用才提升为变量。
- **硬编码保留**：单组件专用值、交互逻辑参数、特殊用法值必须保持硬编码。
- **避免过度抽象**：不为单一组件创建变量，保持代码简洁性。

## 校验清单

### 基础规范校验

- 不存在 `utils/` 工具类引用或全局类名定义。
- `index.scss` 仅包含 `variables.scss`、`mixins.scss`、`base/reset.scss`、`base/animations.scss`、`business/colors/index.scss`。
- 组件中的样式均通过 CSS 变量与混入实现，无全局类依赖。

### 变量分离校验

- `variables.scss` 包含完整的 9 大变量系统（总计约 80 个变量），优先定义通用变量。
- **复用性验证**：新增变量前使用 `grep` 搜索确认至少有 2 个不同组件的复用需求。
- **变量系统完整性**：确保颜色、透明度、字体、间距、尺寸、视觉、层级、动画系统变量正确使用。
- **硬编码保留验证**：单组件专用值、交互参数、特殊用法值必须保持硬编码。
- 组件中优先使用通用变量（如 `--spacing-micro` 而非 `--spacing-1`），避免不必要的业务专用变量依赖。
- 确需创建的业务专用变量正确分类存放在 `business/colors/` 或 `business/icons/` 对应模块中。
- **禁止过度抽象**：不为单一组件创建变量，保持合理的抽象层级。

### 组件规范校验

- 组件内不存在 SCSS 变量定义（`$variable-name`）。
- 组件内不存在混入定义（`@mixin mixin-name`）。
- 组件优先使用通用变量（`var(--spacing-micro/mini/xs)`、`var(--text-primary/secondary)`、`var(--bg-primary/secondary)`、`var(--border-radius-base/md)`、`var(--shadow-card/md)`、`var(--z-index-dropdown/modal-backdrop)`、`var(--transition-base/fast)`等）。
- 组件混入调用使用正确前缀（`@include flex-*` 等）。

## 问题解决

### Unknown at rule @use 错误

**问题描述**：在使用 `@use "@/assets/styles/index.scss" as *;` 语法时，编辑器报告 `Unknown at rule @use` 错误。

**根本原因**：组件的 `<style>` 标签缺少 `lang="scss"` 属性声明，导致编辑器无法识别 SCSS 语法。

**解决方案**：

- 确保所有使用 SCSS 语法的组件样式块都明确声明语言类型
- 将 `<style scoped>` 修改为 `<style scoped lang="scss">`

**示例**：

```vue
<!-- 错误写法 -->
<style scoped>
@use "@/assets/styles/index.scss" as *;
</style>

<!-- 正确写法 -->
<style scoped lang="scss">
@use "@/assets/styles/index.scss" as *;
</style>
```

**检查清单**：

- 所有组件的 `<style>` 标签都包含 `lang="scss"` 属性
- 使用 `@use` 语法的组件必须声明 SCSS 语言类型
- 与项目中其他组件保持一致的样式声明方式
